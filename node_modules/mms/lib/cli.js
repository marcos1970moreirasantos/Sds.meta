// Generated by CoffeeScript 1.8.0
(function() {
  var args, commander, mms, pkg, _exit;

  commander = require('commander');

  pkg = require('../package.json');

  mms = require('./mms');

  _exit = function(err) {
    var code;
    code = err ? err.code || 1 : 0;
    return process.exit(code);
  };

  commander.version(pkg.version).usage('[command] [options]');

  commander.command('migrate').usage('[name|version|step]').description('(default) migrate to the given migration').action(function(name, options) {
    if (arguments.length === 1) {
      name = null;
    }
    return mms.migrate(name).then(_exit);
  });

  commander.command('rollback').usage('[name|version|step]').description('rollback till given migration').action(function(name, options) {
    if (arguments.length === 1) {
      name = null;
    }
    return mms.rollback(name).then(_exit);
  });

  commander.command('create').usage('[name]').description('create a new migration file with its name').action(function(name, options) {
    if (arguments.length === 1) {
      name = null;
    }
    return mms.create(name).then(_exit);
  });

  commander.command('status').description('show status of migrations').action(function() {
    return mms.status().then(_exit);
  });

  args = commander.parse(process.argv);

  if (args.args.length < 1) {
    mms.migrate(null).then(_exit);
  }

}).call(this);
